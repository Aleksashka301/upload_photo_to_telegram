# Программа для загрузки фото в telegram

 Программа имеет скрипты для скачивания фото с таких ресурсов как `api.spacexdata.com`, `api.nasa.gov`. Так же 
создаёт необходимые директории на компьютере. Размещение фото происходит с задержкой и интервалом, которые можно
настроить.

## fetch_spacex_images

 Данный скрипт скачивает фото взлётов SpaceX с сайта `https://api.spacexdata.com/v5/launches/`. Так же создаёт 
директорию `photos from space/spacex`, в данной директории и будут храниться фото скачанные с ресурса. Для выбора
фото запуска нужно ввести id, например такой `5eb87d47ffd86e000604b38a`. При отсутствии id скрипт найдёт последний
запуск у которого есть фото и скачает их в нужную директорию. Скрипт предназначен для работы из терминала. Для 
запуска необходимо ввести команду:
```python
python fetch_spacex_images.py (id запуска)
```

## nasa_images

 Данный скрипт скачивает фото с ресурса `https://api.nasa.gov/planetary/apod`. Так же создаёт директорию
`photos from space/nasa`. В данном скрипте можно настроить необходимое количество фото, которое скачает скрипт,
по умолчанию стоит значение 30. При запуске скрипта можно указать необходимое количество.
```python
python nasa_images.py (количество фотографий)
```
 Для работы скрипта необходим `api key`, который можно получить на сайте `https://api.nasa.gov`. В скрипте так же
предусмотренны исключения. На случай если поле `title` окажется пустым и ссылки там не будет, тогда в консоль
выведется сообщение `Ссылка не найдена`
```python
    try:
        title = obj['title'].replace(' ', '_').replace('\r', '').replace('\n', '').strip()
        links_images[title] = obj['url']
    except KeyError:
        print('Ссылка не найдена!')
```
 На случай если ссылка будет вести не на фото, тогда в консоль выведется сообщение `Не верная ссылка: ссылка`
```python
    try:
        response = requests.get(values)
        response.raise_for_status()
    except (requests.exceptions.MissingSchema, requests.exceptions.HTTPError) as error:
        print(f'Не верная ссылка: {error}')
```
 Так же скрипт перед созданием, проверяет имена картинок. И удаляет знаки не допустимые в названиях файлов такие
как `\/:*?"<>|`
```python
    for symbol in '\/:*?"<>|':
        key = key.replace(symbol, '')
```

## nasa_earth_images

 Данный скрипт скачивает фото земли с ресурса `https://api.nasa.gov/EPIC/archive/natural` Как и пред идущие
скрипты создаёт свою директорию `photos from space/earth photos nasa`, куда в последствии сохраняет фото. Для 
работы скрипта необходим `api key`, который можно получить на сайте `https://api.nasa.gov`. Для запуска скрипта
введите команду.
```python
python nasa_earth_images.py
```

## helper_functions

 Данный блок содержи вспомогательные функции такие как `get_file_type` принимает url файла, возвращает тип файла 
и `time_interval` принимает заданное время в минутах, возвращает общее время в секундах.

## telegram_bot

 Основной модуль программы. Для работы скрипта не обходимы `token` от телеграм бота, `chat_id` от телеграм 
сообщества, `trigger_interval` когда и с каким интервалом будет запущен телеграм бот. После запуска скрипта,
запускается заданный при запуске таймер, если же таймер не указан, то по умолчанию установленно значение на 
4 часа. Затем скрипт проверяет содержимое основной папки `photos from space` на наличие вложенных папок и 
картинок в них. После данные сохраняются в словарь `dict` где ключи, это названия папок, а значения ключей фото в
них. При публикации фото в телеграм, сначала случайным образом выбирается папка с фото, а затем, так же случайным
образом выбирается фото из этой папки. Для запуска скрипта нужно ввести команду.
```python
python telegram_bot.py (время отсрочки скрипта и его интервал в минутах)
```

## Установка

 Склонируйте репозиторий на ваш компьютер:

 ```
 git clone https://github.com/Aleksashka301/upload_photo_to_telegram
```

Установите виртуальное окружение:

```
cd upload_photo_to_telegram
python -m venv venv
```

Далее нужно активировать виртуальное окружение:
```
venv\Scripts\activate
```

Для работы программы необходим `Python v3.11`. Так же для работы понадобятся библиотеки, которые находятся в файле
`requirements.txt`. Для их  установки нужно запустить команду:
```
pip install -r requirements.txt
```
После в корневой папке нужно создать файл `.env` и добавит туда переменные окружения:
 1. `NASA_API_KEY` - api ключ от сайта `https://api.nasa.gov` необходим для отправки запросов
 2. `TELEGRAM_TOKEN` - token для телеграм бота, необходим для настройки бота
 3. `TG_CHANNEL_ID` - id канала к которому подключён телеграм бот, как правило имеет тоже id, что и название канала @телеграм_канал
 4. `TRIGGER_INTERVAL` - интервал через который бот будет отправлять сообщения, по умолчанию стоит значение 14400 (4 часа в секундах)

 После можно запустить скрипты поочереди, чтобы создались директории с фото и запустить основной модуль. Так же
 можно в ручную создать в корне папку `photos from space` и загружать туда фото создавая необходимые папки.

